<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/layout :: head('Dashboard')}"></head>

<body>
<nav th:replace="~{fragments/layout :: navbar}"></nav>
<div class="main-content">
    <div th:replace="~{fragments/layout :: alerts}"></div>

    <div class="dashboard-header d-flex justify-content-between align-items-center flex-wrap gap-3">
        <h1 class="mb-0">Welcome, <span th:text="${user.fullName}">User</span>!</h1>
        <span class="badge"
              th:classappend="${user.role.name() == 'BUSINESS'} ? 'badge-business' : 'badge-personal'"
              th:text="${user.role}">PERSONAL</span>
    </div>

    <div class="card wallet-card">
        <div class="wallet-info">
            <h2>Wallet Balance</h2>
            <p class="balance mb-0">$<span th:text="${#numbers.formatDecimal(balance, 1, 2)}">0.00</span></p>
        </div>
        <div class="wallet-actions">
            <a th:href="@{/wallet/add-funds}" class="btn btn-success"><i class="bi bi-plus-circle me-1"></i>Add Funds</a>
            <a th:href="@{/wallet/withdraw}" class="btn btn-warning"><i class="bi bi-arrow-down-circle me-1"></i>Withdraw</a>
            <a th:href="@{/transactions/send}" class="btn btn-primary"><i class="bi bi-send me-1"></i>Send Money</a>
            <a th:href="@{/requests/create}" class="btn btn-secondary"><i class="bi bi-arrow-left-right me-1"></i>Request Money</a>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon"><i class="bi bi-envelope-paper"></i></div>
            <div class="stat-info">
                <h3 th:text="${pendingRequests}">0</h3>
                <p>Pending Requests</p>
            </div>
        </div>
                <a th:href="@{/notifications}" class="stat-card stat-card-link" aria-label="Open notifications">
            <div class="stat-icon"><i class="bi bi-bell"></i></div>
            <div class="stat-info">
                <h3 th:text="${unreadNotifications}">0</h3>
                <p>Unread Notifications</p>
            </div>
        </a>
        <div sec:authorize="hasRole('BUSINESS')" class="stat-card stat-business">
            <div class="stat-icon"><i class="bi bi-graph-up-arrow"></i></div>
            <div class="stat-info">
                <h3>$<span th:text="${totalReceived != null} ? ${#numbers.formatDecimal(totalReceived, 1, 2)} : '0.00'">0.00</span></h3>
                <p>Total Received</p>
            </div>
        </div>
        <div sec:authorize="hasRole('BUSINESS')" class="stat-card stat-business">
            <div class="stat-icon"><i class="bi bi-graph-down-arrow"></i></div>
            <div class="stat-info">
                <h3>$<span th:text="${totalSent != null} ? ${#numbers.formatDecimal(totalSent, 1, 2)} : '0.00'">0.00</span></h3>
                <p>Total Sent</p>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2>Recent Transactions</h2>
            <a th:href="@{/transactions/history}" class="link">View All <i class="bi bi-arrow-right"></i></a>
        </div>
        <div th:if="${#lists.isEmpty(recentTransactions)}" class="empty-state">
            <p>No transactions yet. Start by sending money or adding funds.</p>
        </div>
        <table th:unless="${#lists.isEmpty(recentTransactions)}" class="data-table">
            <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Amount</th>
                <th>From/To</th>
                <th>Status</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="txn : ${recentTransactions}">
                <td th:text="${#temporals.format(txn.timestamp, 'MMM dd, yyyy')}">Jan 01</td>
                <td><span class="badge" th:classappend="'badge-' + ${txn.type.name().toLowerCase()}" th:text="${txn.type}">SEND</span></td>
                <td class="amount"
                    th:classappend="${txn.type.name() == 'SEND' || txn.type.name() == 'WITHDRAWAL'} ? 'amount-out' : 'amount-in'"
                    th:text="${(txn.type.name() == 'SEND' || txn.type.name() == 'WITHDRAWAL') ? '-$' : '+$'} + ${#numbers.formatDecimal(txn.amount, 1, 2)}">$0.00</td>
                <td th:text="${txn.sender != null && txn.receiver != null} ? (${txn.type.name() == 'SEND'} ? ${txn.receiver.fullName} : ${txn.sender.fullName}) : 'Wallet'">N/A</td>
                <td><span class="badge" th:classappend="'badge-' + ${txn.status.name().toLowerCase()}" th:text="${txn.status}">SUCCESS</span></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
<footer th:replace="~{fragments/layout :: footer}"></footer>
<div th:replace="~{fragments/layout :: scripts}"></div>
</body>

</html>


